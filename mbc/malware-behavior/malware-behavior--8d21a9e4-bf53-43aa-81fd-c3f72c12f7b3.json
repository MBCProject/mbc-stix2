{
    "type": "bundle",
    "id": "bundle--324b74f2-ee3d-4436-8839-2121d98672b9",
    "objects": [
        {
            "type": "malware-behavior",
            "spec_version": "2.1",
            "id": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
            "created_by_ref": "identity--b73c59c1-8560-449a-b8d0-c2ce0533c5bf",
            "created": "2019-08-01T00:00:00.000Z",
            "modified": "2023-09-13T00:00:00.000Z",
            "name": "Virtual Machine Detection",
            "obj_defn": {
                "description": "Malware checks whether it is being executed inside a virtual environment. In performing reconnaissance of its environment, the malware will check on a variety of user or system based artifacts. Examples include: \n\n- monitoring for user action as reflected by scrolling\n- verifying system characteristics through Windows Management Interface (WMI) queries, e.g., for MAC address\n- observing whether tool artifacts represented by strings or processes exist, e.g., VirtualBox.exe or joeboxserver.exe  \n- checking specific registry keys or values [1]\n\nUpon detection of the virtual machine, conditional execution will change the malware\u2019s behavior. For example, execution may terminate, or activity may appear benign, e.g., connecting to a benign domain.\n\nThe related **Virtualization/Sandbox Evasion ([T1497](https://attack.mitre.org/techniques/T1497/), [T1633](https://attack.mitre.org/techniques/T1633/))** ATT&CK techniques were defined subsequent to this MBC behavior.",
                "external_id": "B0009",
                "source_name": "mitre-mbc",
                "url": "https://github.com/MBCProject/mbc-markdown/blob/main/anti-behavioral-analysis/virtual-machine-detection.md"
            },
            "tags": {
                "Anti-Analysis-Type": "Detection"
            },
            "objective_refs": [
                "malware-objective--f38b4e5f-7c1b-4c17-9610-a739550ab918"
            ],
            "detection_rules": [
                {
                    "api_fncs": [
                        "GetModuleHandle"
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "check for sandbox and av modules",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-av/check-for-sandbox-and-av-modules.yml"
                },
                {
                    "api_fncs": [
                        "SLIsGenuineLocal",
                        "UuidFromString"
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "check for Windows sandbox via genuine state",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-genuine-state.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "reference anti-VM strings targeting Parallels",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/reference-anti-vm-strings-targeting-parallels.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-method--610e10e9-530f-4871-9f31-2548e10d2d01",
                    "rule_name": "check for unmoving mouse cursor",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-unmoving-mouse-cursor.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "reference anti-VM strings targeting VirtualPC",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/reference-anti-vm-strings-targeting-virtualpc.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "reference anti-VM strings targeting VMWare",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/reference-anti-vm-strings-targeting-vmware.yml"
                },
                {
                    "api_fncs": [
                        "Sleep"
                    ],
                    "detect_ref": "malware-method--610e10e9-530f-4871-9f31-2548e10d2d01",
                    "rule_name": "check for foreground window switch",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-foreground-window-switch.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-method--610e10e9-530f-4871-9f31-2548e10d2d01",
                    "rule_name": "detect VM via disk hardware WMI queries",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/detect-vm-via-disk-hardware-wmi-queries.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "reference anti-VM strings targeting Qemu",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/reference-anti-vm-strings-targeting-qemu.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "reference anti-VM strings targeting Xen",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/reference-anti-vm-strings-targeting-xen.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "check for sandbox username or hostname",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-sandbox-username-or-hostname.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "check for Windows sandbox via process name",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-process-name.yml"
                },
                {
                    "api_fncs": [
                        "GetAdaptersAddresses"
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "check for Windows sandbox via dns suffix",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-dns-suffix.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "check for Windows sandbox via device",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-device.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "reference anti-VM strings targeting VirtualBox",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/reference-anti-vm-strings-targeting-virtualbox.yml"
                },
                {
                    "api_fncs": [
                        "RegOpenKeyEx",
                        "RegEnumValue"
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "check for Windows sandbox via registry",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-windows-sandbox-via-registry.yml"
                },
                {
                    "api_fncs": [
                        " "
                    ],
                    "detect_ref": "malware-behavior--8d21a9e4-bf53-43aa-81fd-c3f72c12f7b3",
                    "rule_name": "reference anti-VM strings",
                    "rule_type": "capa",
                    "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/reference-anti-vm-strings.yml"
                }
            ],
            "snippets": [
                {
                    "exemplify_ref": "malware-method--610e10e9-530f-4871-9f31-2548e10d2d01",
                    "hash": "SHA256: cfaf863181e49906df33f9104795678f2fb41a007a8fd066a84fd99f613d7ef3",
                    "language": "asm",
                    "snippet": "; ___unwind { // __except handler4\npush ebp\nmov ebp, esp\npush 0FFFFFFFEh\npush offset stru_413980\npush offset __except handler4\nmov eax, large fs:0\npush eax\nsub esp, 14h\npush ebx\npush esi\npush edi\nmov eax, ___security_cookie\nxor [epb+ms_exc.registration.ScopeTable], eax\nxor eax, ebp\npush eax\nlea eax, [ebp+ms_exc.registration]\nmov large fs:0 eax\nmov [ebp+var_19], al\n;  __try { // __except at loc_401CB8\nmov [ebp+ms_exc.registration.TryLevel], eax\npush ebx\nmov ebx, 0\nmov eax, 1\nvpcext 7, 08h\ntest ebx, ebx\nsetz [ebp+var_19]\npop ebx\njmp short loc_401CBB"
                }
            ],
            "obj_version": "2.0",
            "related_object_refs": [
                "attack-pattern--82caa33e-d11a-433a-94ea-9b5a5fbef81d",
                "attack-pattern--27d18e87-8f32-4be1-b456-39b90454360f"
            ],
            "external_references": [
                {
                    "source_name": "checkpoint",
                    "description": "Check Point Research, \"CP<r>: Evasion Techniques,\" evasions.checkpoint.com, [Online].",
                    "url": "https://evasions.checkpoint.com"
                },
                {
                    "source_name": "unprotect-sandboxevasion",
                    "description": "T. Roccia and J. Lesueur, \"Sandbox Evasion,\" Unprotect Project, Accessed Apr. 29, 2023 [Online].",
                    "url": "https://unprotect.it/category/sandbox-evasion/"
                },
                {
                    "source_name": "rascagneres-gravityrat",
                    "description": "P. Rascagneres, \"GravityRAT - The Two-Year Evolution Of An APT Targeting India,\" Talos, blog, Apr. 26, 2018 [Online].",
                    "url": "https://blog.talosintelligence.com/2018/04/gravityrat-two-year-evolution-of-apt.html"
                },
                {
                    "source_name": "mcafee-webcobra",
                    "description": "\"WebCobra Malware Uses Victims' Computers to Mine Cryptocurrency,\" McAfee, blog, Nov. 12, 2018 [Online].",
                    "url": "https://www.mcafee.com/blogs/other-blogs/mcafee-labs/webcobra-malware-uses-victims-computers-to-mine-cryptocurrency/"
                },
                {
                    "source_name": "lordnoteworthy",
                    "description": "A. Faouzi (LordNoteworthy), \"README.md,\" Al-Khaser v0.81. Accessed Apr. 29, 2023 [Online].",
                    "url": "https://github.com/LordNoteworthy/al-khaser"
                },
                {
                    "source_name": "fireeye-vmaware",
                    "description": "\"The Dead Giveaways of VM-Aware Malware,\" FireEye, Jan 2011.",
                    "url": "https://web.archive.org/web/20160927120026/https://www.fireeye.com/blog/threat-research/2011/01/the-dead-giveaways-of-vm-aware-malware.html"
                },
                {
                    "source_name": "shulmin-emotet",
                    "description": "A. Shulmin, \"The Banking Trojan Emotet: Detailed Analysis,\" Secure List by Kaspersky, Apr. 9, 2015 [Online].",
                    "url": "https://securelist.com/the-banking-trojan-emotet-detailed-analysis/69560/"
                },
                {
                    "source_name": "sonicwall",
                    "description": "\"Revisiting Vobfus Worm,\" SonicWALL, Mar. 8, 2013 [Online].",
                    "url": "https://securitynews.sonicwall.com/xmlpost/revisiting-vobfus-worm-mar-8-2013/"
                },
                {
                    "source_name": "dong-matanbuchus",
                    "description": "C. Dong, \"MATANBUCHUS: Another Loader as a Service Malware,\" Offset Training Solutions, blog, Feb. 15, 2022 [Online].",
                    "url": "https://www.0ffset.net/reverse-engineering/matanbuchus-loader-analysis/"
                },
                {
                    "source_name": "cohen-matabuchus",
                    "description": "B. Cohen, \"Inside Matanbuchus: A Quirky Loader,\" CyberArk, blog, Jul. 26, 2022 [Online].",
                    "url": "https://www.cyberark.com/resources/threat-research-blog/inside-matanbuchus-a-quirky-loader"
                },
                {
                    "source_name": "proofpoint-ursnif",
                    "description": "\"Ursnif Banking Trojan Campaign Ups the Ante with New Sandbox Evasion Techniques,\" Proofpoint, Sep. 20, 2016 [Online].",
                    "url": "https://www.proofpoint.com/us/threat-insight/post/ursnif-banking-trojan-campaign-sandbox-evasion-techniques"
                },
                {
                    "source_name": "capa analysis",
                    "description": "Analysis output, capa 4.0, analyzed at MITRE on Oct. 12, 2022.",
                    "url": "https://github.com/mandiant/capa-rules"
                },
                {
                    "source_name": "hackread",
                    "description": "Waqas, \"GravityRAT malware evades detection and targets users in India,\" HACKREAD, May 1, 2018.",
                    "url": "https://www.hackread.com/gravityrat-malware-evades-detection-targets-india/"
                }
            ],
            "object_marking_refs": [
                "marking-definition--093b6375-cd45-4aa3-8f91-6a03ddd7a3d3"
            ],
            "extensions": {
                "extension-definition--d57b7c9c-7fa6-436b-b82c-8e6f69cdc3d0": {
                    "extension_type": "new-sdo"
                }
            }
        }
    ]
}